{% extends "base.html" %}

{% block content %}
<br xmlns="http://www.w3.org/1999/html"/>
<h2 class="text-center"> Data Management </h2>
<br/>

<div class="row justify-content-center">
  <div class="col col-6 bg-light p-3 border border-secondary rounded">
    <!-- Selection Box -->
    <div class="my-4">
      <h4>Backup Data</h4>
      <form action="{{ url_for('main.backup') }}" method="post" enctype="multipart/form-data"
            class="mb-3">
        <label for="dataTypeSelect" class="form-label">Select Data Type to Download</label>
        <select class="form-select" id="dataTypeSelect" name="loader_type">
          {% for name, value in weather_loaders %}
          <option value="weather_loaders:{{ value }}">Weather Data from : {{ name }}</option>
          {% endfor %}
          <option selected value="target_loaders">PV Data</option>
        </select>
        <div class="mt-3">
          <button type="submit" class="btn btn-primary">Download</button>
        </div>
      </form>
    </div>

    <hr class="my-4">
    <!-- Separation -->
    <div class="my-4">
      <h4>Restore Data</h4>
      <!-- File Upload Form 1 -->
      <form action="{{ url_for('main.restore') }}" method="post" enctype="multipart/form-data"
            class="mb-3">
        <input type="hidden" name="loader_type" value="weather_loaders">

        <label for="weather_loader_select_upload" class="form-label">Select weather loader to
          restore data to. (make sure the location of the data loader and the csv. file match) :</label>
        <select name="weather_loader" id="weather_loader_select_upload">

          {% for name, value in weather_loaders %}
          <option value="{{ value }}">{{ name }}</option>
          {% endfor %}
        </select>

        <label for="fileUpload1" class="form-label">Upload Weather Data csv File</label>
        <input type="file" class="form-control" id="fileUpload1" name="file" accept=".csv">
        <div class="mt-3">
          <button type="submit" class="btn btn-success">Upload</button>
        </div>
      </form>
    </div>
    <!-- Separation -->


    <!-- File Upload Form 2 -->
    <div class="my-4">
      <form action="{{ url_for('main.restore') }}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="loader_type" value="target_loaders">
        <label for="fileUpload2" class="form-label">Upload PV Data csv File</label>
        <input type="file" class="form-control" id="fileUpload2" name="file" accept=".csv">
        <div class="mt-3">
          <button type="submit" class="btn btn-success">Upload</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="row justify-content-center mt-3">
  <div class="col col-6 bg-light p-3 border border-secondary rounded">
    <div class="container mt-3 justify-content-center">
      <h4>Delete Data</h4>
      <button class="btn btn-danger mb-3"
              onclick="confirmDeletion( '{{url_for('main.delete_data') }}','pv_forecast')">Delete PV
        Forecast
      </button>
      <button class="btn btn-danger mb-3"
              onclick="confirmDeletion( '{{url_for('main.delete_data') }}','pv_evaluation')">Delete
        PV Evaluation
      </button>
      <button class="btn btn-danger mb-3"
              onclick="confirmDeletion( '{{url_for('main.delete_data') }}','pv_measurement')">Delete
        PV Measurement
      </button>
      <button class="btn btn-danger mb-3"
              onclick="confirmDeletion( '{{url_for('main.delete_data') }}','weather_forecast')">
        Delete
        Weather Forecast
      </button>
    </div>

  </div>
</div>


<script>
  function confirmDeletion(url, dataType) {
    const isConfirmed = confirm(`Are you sure you want to delete ${dataType.replace('_', ' ')} data?`);
    console.log(url + `?data_type=${dataType}`)

    if (isConfirmed) {
      // Construct the URL with the data_type parameter
      const r_url = url + `?data_type=${dataType}`;


      // Redirect to the URL
      window.location.href = r_url;
    }
  }
</script>
{% endblock %}